あなたは熟練したフルスタックエンジニアです。
以下の「新生児育児記録・行動予測アプリ（BabyLog）」の要件定義書に基づき、Azure App Service上で動作するWebアプリケーションのソースコードを作成してください。

## 前提条件
- 実装は **Python (FastAPI)** と **Vanilla JavaScript (Vue.js CDN版でも可)** で行います。
- データベースは **Azure SQL Database** を想定し、ORMには **SQLAlchemy** を使用してください。
- デザインは **Tailwind CSS (CDN)** を使用し、モバイルファーストで作成してください。
- ファイル構成は、デプロイしやすいフラットな構成または標準的なFastAPIの構成にしてください。

---

# 新生児育児記録・行動予測アプリ 要件定義書

## 1. プロジェクト概要
### 1.1 目的
新生児育児における記録作業の負担を最小化し、蓄積データから「次に必要になりそうな行動」を提示する。
**正確さよりも「安心感」と「即行動できる状態」** を優先する。

### 1.2 ターゲットユーザー
* **妻（メイン）**: スマホ操作。思考不要。1タップで完了。
* **夫（サブ）**: PC/スマホ。データ修正、傾向分析。

---

## 2. システム要件 & 技術スタック
* **Backend**: Python 3.10+, FastAPI, SQLAlchemy, Pydantic
* **Frontend**: HTML5, Tailwind CSS, JavaScript (Fetch API使用)
* **Database**: Azure SQL Database (ドライバは `pyodbc` または `mssql-django` 等適したもの。開発時は `sqlite` で動作し、環境変数で切り替え可能にすること)
* **Infrastructure**: Azure App Service (Linux)

---

## 3. 機能要件詳細

### 3.1 データモデル (SQLAlchemy Models)
**Table: events**
* `id`: UUID (Primary Key)
* `event_type`: String ("milk", "diaper")
* `timestamp`: DateTime (UTC保存, アプリ表示時にJST変換)
* `is_pee`: Boolean (Default: False)
* `is_poop`: Boolean (Default: False)
* `amount`: Integer (ml または 分)
* `side`: String ("left", "right", null)
* `condition_code`: String ("normal", "soft", "diarrhea", null)
* `note`: Text (Optional)
* `is_deleted`: Boolean (Default: False, 論理削除用)

**Table: settings** (本来はユーザー別だが今回は単一ユーザー想定)
* `key`: String (PK)
* `value`: String

### 3.2 API エンドポイント設計
* `GET /api/events`: 履歴取得（日付フィルタ可）
* `POST /api/events`: 新規記録作成
* `PUT /api/events/{id}`: 記録修正
* `DELETE /api/events/{id}`: 論理削除
* `GET /api/prediction`: 次の授乳予測時刻とメッセージを返す
    * ロジック: 直近3件の `event_type=milk` の間隔平均 + 設定値(デフォルト3時間) から算出。

### 3.3 UI/UX 実装要件 (Frontend)

#### A. トップ画面 (妻用モード)
1.  **予測表示エリア**:
    * 画面最上部に大きく表示。「次は 14:30 頃 (あと30分) です」等。
    * 前回授乳からの経過時間が設定値を超えたら背景色を黄色→赤に変更。
2.  **アクションエリア (巨大ボタン)**:
    * **[🍼 ミルク]**: タップで即 `POST`。量は前回の値をデフォルト採用。
    * **[🤱 母乳]**:
        * トグル式。[開始] タップで計測開始(LocalStorageに開始時刻保存)、[終了] タップで `POST` (amount=分数)。
    * **[💧 おしっこ]**, **[💩 うんち]**, **[💧💩 両方]**:
        * タップで即 `POST`。
        * おしっこ: `is_pee=True`
        * うんち: `is_poop=True`
        * 両方: `is_pee=True, is_poop=True`
3.  **直近履歴リスト**:
    * 最新3件を表示。各行に「取り消し」ボタン配置。

#### B. ダッシュボード (夫用モード/下部切替)
1.  **タイムライン**: 全データのリスト表示・編集。
2.  **簡易グラフ**: Chart.js等を使用し、日毎の授乳回数・排泄回数を表示。

### 3.4 認証・セキュリティ
* **簡易認証**:
    * ミドルウェアで実装。
    * 特定のヘッダーまたはCookieに「家族共通パスコード」が無い場合、ログイン画面へリダイレクト。
    * パスコードは環境変数 `FAMILY_PASSCODE` と照合 (ハッシュ化は任意だが今回は平文比較でMVPとする)。

---

## 4. 出力への指示
以下のファイル構成でコードを出力してください。
コードブロックはファイルごとに分けてください。

1.  `requirements.txt` (必要なライブラリ)
2.  `database.py` (DB接続設定)
3.  `models.py` (SQLAlchemyモデル)
4.  `schemas.py` (Pydanticスキーマ)
5.  `crud.py` (DB操作ロジック)
6.  `main.py` (FastAPIアプリ本体、APIルート)
7.  `templates/index.html` (Vue.js または Vanilla JS + Tailwind を含んだフロントエンド単一ファイル)
8.  `templates/login.html` (簡易ログイン画面)

※ Azure Web Appsへのデプロイを考慮し、環境変数 (`DB_CONNECTION_STRING`) の読み込み部分を実装に含めてください。